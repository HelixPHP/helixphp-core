name: Quality Gate - PivotPHP Core v1.1.3

on:
  push:
    branches: [ main, develop, feature/* ]
  pull_request:
    branches: [ main, develop ]

jobs:
  quality-gate:
    name: Quality Gate Assessment
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: mbstring, xml, ctype, iconv, intl, pdo, dom, filter, gd, json, session
        
    - name: Install dependencies
      run: composer install --prefer-dist --no-progress
      
    # Valida√ß√£o minimalista - testes completos s√£o feitos localmente via Docker
    - name: Run Quality Gate
      run: |
        echo "üèÜ Running optimized Quality Gate..."
        echo "üí° Full validation should be done locally via: ./scripts/test-all-php-versions.sh"
        echo "üìã This CI focuses on critical breaking changes detection only"
        ./scripts/quality-gate.sh

    - name: Summary
      if: always()
      run: |
        echo ""
        echo "========================================="
        echo "        QUALITY GATE SUMMARY"
        echo "========================================="
        echo ""
        echo "‚úÖ Quality Gate completed for CI/CD pipeline"
        echo ""
        echo "üìã For comprehensive testing:"
        echo "   ‚Ä¢ Run locally: ./scripts/test-all-php-versions.sh"
        echo "   ‚Ä¢ Run locally: ./scripts/validate_all.sh"
        echo "   ‚Ä¢ Run extended metrics: ./scripts/quality-metrics.sh"
        echo ""
        echo "üöÄ CI/CD pipeline optimized for speed and critical validations only"