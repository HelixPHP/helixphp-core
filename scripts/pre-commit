#!/bin/bash

# PivotPHP - Pre-commit Hook
# Executa todas as valida√ß√µes usando o script centralizado validate_all.sh

set -e

echo "üîç Executando valida√ß√µes pre-commit..."

# Cores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

print_status() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[‚úì]${NC} $1"
}

print_error() {
    echo -e "${RED}[‚úó]${NC} $1"
}

# Verifica se as depend√™ncias est√£o instaladas
if [ ! -d "vendor" ]; then
    print_error "Depend√™ncias n√£o encontradas. Execute 'composer install' primeiro."
    exit 1
fi

# Verifica se o script validate_all.sh existe
if [ ! -f "scripts/validate_all.sh" ]; then
    print_error "Script validate_all.sh n√£o encontrado!"
    exit 1
fi

print_status "Executando todas as valida√ß√µes via validate_all.sh..."

# Executa o script centralizado de valida√ß√£o
if scripts/validate_all.sh --pre-commit; then
    print_success "Todas as valida√ß√µes passaram! üéâ"
    echo ""
    echo "Commit autorizado ‚úÖ"
    exit 0
else
    print_error "Uma ou mais valida√ß√µes falharam!"
    echo ""
    print_error "Commit rejeitado ‚ùå"
    echo ""
    echo "Corrija os problemas reportados acima e tente novamente."
    echo "Para detalhes espec√≠ficos, execute: scripts/validate_all.sh"
    exit 1
fi
