# PivotPHP v1.0.1 - PSR-7 Compatibility Status

## Summary

PivotPHP Core v1.0.1 has been updated to allow installation alongside both PSR-7 v1.x and v2.x through flexible composer constraints, while the implementation remains on PSR-7 v2.0.

## What Was Done

### 1. Composer Configuration Updated âœ…
```json
{
    "require": {
        "psr/http-message": "^1.1|^2.0"
    }
}
```

### 2. Documentation Created âœ…
- Created comprehensive PSR-7 compatibility guide at `docs/technical/compatibility/psr7-versions.md`
- Created HTTP components documentation at `docs/technical/http/README.md`
- Updated CHANGELOG.md to mention PSR-7 compatibility support

### 3. Implementation Status ðŸ”„
- Current implementation uses PSR-7 v2.0 interfaces with return type hints
- Attempted to create abstract base classes for dual compatibility (reverted)
- The attempt failed because PSR-7 v2.0 requires return type declarations

## Current State

### What Works
1. **Pure PivotPHP Projects**: Full functionality with PSR-7 v2.0
2. **Composer Installation**: Can be installed in projects using either PSR-7 v1.x or v2.x
3. **Type Safety**: Full PHPStan Level 9 compliance with PSR-7 v2.0

### Limitations
1. **Runtime Compatibility**: Projects using PSR-7 v1.x libraries (like ReactPHP) cannot directly use PivotPHP's HTTP objects
2. **Bridge Required**: Integration with PSR-7 v1.x libraries requires an external bridge/adapter

## Recommended Approach for ReactPHP Integration

Users who need to integrate PivotPHP with ReactPHP should:

1. **Use a PSR-7 Bridge Library**
   ```bash
   composer require some/psr7-bridge
   ```

2. **Implement Custom Adapter**
   ```php
   class Psr7Adapter {
       public static function convertRequest($v1Request) {
           // Convert PSR-7 v1.x to v2.0
       }
       
       public static function convertResponse($v2Response) {
           // Convert PSR-7 v2.0 to v1.x
       }
   }
   ```

3. **Wait for Future Updates**
   - Future versions may include built-in dual compatibility
   - Conditional loading based on installed PSR-7 version

## Technical Challenges

The main challenge in supporting both PSR-7 versions simultaneously:

1. **Return Type Declarations**: PSR-7 v2.0 requires return types, v1.x doesn't have them
2. **PHP Limitations**: Cannot conditionally declare return types at runtime
3. **Interface Compliance**: Must implement exact interface signatures

## Conclusion

PivotPHP v1.0.1 maintains full PSR-7 v2.0 compliance while allowing flexible installation. Projects requiring PSR-7 v1.x compatibility should use a bridge pattern until native dual-version support is implemented in a future release.

## References
- [PSR-7 Version Compatibility Guide](../technical/compatibility/psr7-versions.md)
- [HTTP Components Documentation](../technical/http/README.md)
- [CHANGELOG v1.0.1](../../CHANGELOG.md#101---2025-07-08)